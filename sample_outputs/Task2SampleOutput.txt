
Output of Task2 for a run on the whole dataset, with :
* contamination=0.001
* maxSamples=256
* nbFeatures=1 (speed)

**********************************************************************************************************


TASK2 - Removing Outliers and computing top (PULocationId,DOLocationId) pairs for total_amount :
------------------------------------------------------------------------------------------------


Prepare Data :
--------------

Loading the Trips file into a Spark Dataframe ...

Filtering and Enriching the Trips Dataframe ...

Assembling features in the Trips Dataframe ...
(used feature ="speed")

Scaling features in the Trips Dataframe ...

Scaled Dataframe schema :
root
 |-- VendorID: integer (nullable = true)
 |-- tpep_pickup_datetime: timestamp (nullable = true)
 |-- tpep_dropoff_datetime: timestamp (nullable = true)
 |-- passenger_count: integer (nullable = true)
 |-- trip_distance: double (nullable = true)
 |-- RatecodeID: integer (nullable = true)
 |-- store_and_fwd_flag: string (nullable = true)
 |-- PULocationID: integer (nullable = true)
 |-- DOLocationID: integer (nullable = true)
 |-- payment_type: integer (nullable = true)
 |-- fare_amount: double (nullable = true)
 |-- extra: double (nullable = true)
 |-- mta_tax: double (nullable = true)
 |-- tip_amount: double (nullable = true)
 |-- tolls_amount: double (nullable = true)
 |-- improvement_surcharge: double (nullable = true)
 |-- total_amount: double (nullable = true)
 |-- congestion_surcharge: double (nullable = true)
 |-- trip_duration: long (nullable = true)
 |-- speed: double (nullable = true)
 |-- features: vector (nullable = true)


Show 5 rows from the scaled dataframe :
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+---------------------+---------------------+
|VendorID|tpep_pickup_datetime|tpep_dropoff_datetime|passenger_count|trip_distance|RatecodeID|store_and_fwd_flag|PULocationID|DOLocationID|payment_type|fare_amount|extra|mta_tax|tip_amount|tolls_amount|improvement_surcharge|total_amount|congestion_surcharge|trip_duration|speed                |features             |
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+---------------------+---------------------+
|1       |2019-09-01 00:06:48 |2019-09-01 00:25:46  |1              |2.0          |1         |N                 |186         |161         |2           |13.0       |3.0  |0.5    |0.0       |0.0         |0.3                  |16.8        |2.5                 |1138         |0.0017574692442882249|[0.05425839312784938]|
|1       |2019-09-01 00:29:17 |2019-09-01 00:57:54  |1              |5.5          |1         |N                 |161         |256         |2           |22.5       |3.0  |0.5    |0.0       |0.0         |0.3                  |26.3        |2.5                 |1717         |0.00320326150262085  |[0.09889437466138884]|
|1       |2019-09-01 00:41:32 |2019-09-01 00:41:36  |1              |2.9          |1         |N                 |145         |145         |2           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |4            |0.725                |[22.382943625066066] |
|1       |2019-09-01 00:59:11 |2019-09-01 00:59:15  |1              |0.0          |1         |N                 |145         |145         |2           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |4            |0.0                  |[0.0]                |
|1       |2019-09-01 00:39:41 |2019-09-01 00:45:06  |1              |1.5          |1         |N                 |95          |93          |2           |7.0        |0.5  |0.5    |0.0       |0.0         |0.3                  |8.3         |0.0                 |325          |0.004615384615384616 |[0.1424908877988291] |
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+---------------------+---------------------+
only showing top 5 rows


Train Model and save model to disk :
------------------------------------

Training the Isolation Forest model for Outliers Detection ...

Predict Outliers and save predicted dataframe to disk :
-------------------------------------------------------

Predicting Outliers ...

Nb of outliers = 6750

Saving predicted dataframe to disk ...

Show a subset of outliers :
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+--------------------+--------------------+------------------+--------------+
|VendorID|tpep_pickup_datetime|tpep_dropoff_datetime|passenger_count|trip_distance|RatecodeID|store_and_fwd_flag|PULocationID|DOLocationID|payment_type|fare_amount|extra|mta_tax|tip_amount|tolls_amount|improvement_surcharge|total_amount|congestion_surcharge|trip_duration|speed               |features            |outlierScore      |predictedLabel|
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+--------------------+--------------------+------------------+--------------+
|1       |2019-09-01 00:41:32 |2019-09-01 00:41:36  |1              |2.9          |1         |N                 |145         |145         |2           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |4            |0.725               |[22.382943625066066]|0.8240668102878718|1.0           |
|1       |2019-09-01 00:01:29 |2019-09-01 00:02:21  |1              |4.7          |5         |N                 |265         |265         |1           |45.0       |0.0  |0.0    |0.0       |10.5        |0.3                  |55.8        |0.0                 |52           |0.09038461538461538 |[2.790446552727069] |0.8062384779716228|1.0           |
|1       |2019-09-01 00:59:11 |2019-09-01 01:00:52  |1              |2.8          |1         |N                 |231         |231         |3           |3.0        |3.0  |0.5    |0.0       |0.0         |0.3                  |6.8         |2.5                 |101          |0.02772277227722772 |[0.8558858607058379]|0.802429079510112 |1.0           |
|1       |2019-09-01 00:17:43 |2019-09-01 00:18:28  |1              |1.3          |5         |N                 |238         |238         |1           |30.0       |0.0  |0.0    |0.0       |0.0         |0.3                  |30.3        |0.0                 |45           |0.02888888888888889 |[0.8918874088148931]|0.802429079510112 |1.0           |
|1       |2019-09-01 00:56:02 |2019-09-01 00:56:20  |1              |4.6          |1         |N                 |148         |148         |3           |2.5        |3.0  |0.5    |0.0       |0.0         |0.3                  |6.3         |2.5                 |18           |0.25555555555555554 |[7.889773231824054] |0.8190640805652096|1.0           |
|1       |2019-09-01 00:32:23 |2019-09-01 00:32:36  |0              |4.5          |1         |N                 |230         |230         |3           |2.5        |3.0  |0.5    |0.0       |0.0         |0.3                  |6.3         |2.5                 |13           |0.34615384615384615 |[10.68681658491218] |0.8190640805652096|1.0           |
|1       |2019-09-01 00:08:24 |2019-09-01 00:08:36  |1              |1.8          |1         |N                 |7           |7           |1           |2.5        |0.5  |0.5    |36.0      |0.0         |0.3                  |39.8        |0.0                 |12           |0.15                |[4.6309538534619445]|0.8140917213226658|1.0           |
|2       |2019-09-01 00:59:59 |2019-09-01 01:00:03  |1              |0.27         |5         |N                 |50          |50          |1           |38.0       |0.0  |0.5    |7.76      |0.0         |0.3                  |46.56       |0.0                 |4            |0.0675              |[2.0839292340578752]|0.8051482272957834|1.0           |
|1       |2019-09-01 00:36:49 |2019-09-01 00:37:24  |1              |0.9          |1         |N                 |186         |186         |3           |2.5        |3.0  |0.5    |0.0       |0.0         |0.3                  |6.3         |2.5                 |35           |0.025714285714285714|[0.7938778034506191]|0.802429079510112 |1.0           |
|1       |2019-09-01 01:11:50 |2019-09-01 01:12:42  |1              |3.6          |1         |N                 |256         |256         |3           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |52           |0.06923076923076923 |[2.1373633169824364]|0.8062384779716228|1.0           |
|2       |2019-09-01 01:48:45 |2019-09-01 01:48:48  |1              |0.11         |5         |N                 |12          |264         |1           |35.0       |0.0  |0.0    |0.8       |0.0         |0.3                  |36.1        |0.0                 |3            |0.03666666666666667 |[1.1320109419573643]|0.8040594675410649|1.0           |
|1       |2019-09-01 01:58:42 |2019-09-01 02:01:36  |2              |4.3          |1         |N                 |148         |148         |3           |3.5        |3.0  |0.5    |0.0       |0.0         |0.3                  |7.3         |2.5                 |174          |0.02471264367816092 |[0.7629540831374085]|0.802429079510112 |1.0           |
|1       |2019-09-01 02:34:44 |2019-09-01 02:34:54  |1              |3.1          |1         |N                 |68          |68          |1           |2.5        |3.0  |0.5    |3.0       |0.0         |0.3                  |9.3         |2.5                 |10           |0.31                |[9.570637963821353] |0.8190640805652096|1.0           |
|1       |2019-09-01 02:55:16 |2019-09-01 02:55:32  |1              |3.1          |1         |N                 |224         |224         |1           |2.5        |3.0  |0.5    |3.7       |0.0         |0.3                  |10.0        |2.5                 |16           |0.19375             |[5.981648727388346] |0.8168504065424353|1.0           |
|1       |2019-09-01 02:49:39 |2019-09-01 02:49:42  |1              |1.9          |1         |N                 |158         |158         |4           |2.5        |3.0  |0.5    |0.0       |0.0         |0.3                  |6.3         |2.5                 |3            |0.6333333333333333  |[19.552916270172656]|0.8240668102878718|1.0           |
|1       |2019-09-01 02:16:25 |2019-09-01 02:16:45  |1              |2.1          |1         |N                 |71          |71          |3           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |20           |0.10500000000000001 |[3.241667697423362] |0.8095180623993107|1.0           |
|1       |2019-09-01 02:18:27 |2019-09-01 02:18:30  |1              |2.4          |1         |N                 |265         |265         |3           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |3            |0.7999999999999999  |[24.69842055179704] |0.8240668102878718|1.0           |
|1       |2019-09-01 02:19:01 |2019-09-01 02:19:07  |0              |2.4          |1         |N                 |265         |265         |3           |2.5        |0.5  |0.5    |0.0       |0.0         |0.3                  |3.8         |0.0                 |6            |0.39999999999999997 |[12.34921027589852] |0.8207282678530785|1.0           |
|1       |2019-09-01 02:19:41 |2019-09-01 02:20:10  |1              |2.4          |1         |N                 |265         |265         |1           |2.5        |0.5  |0.5    |65.0      |0.0         |0.3                  |68.8        |0.0                 |29           |0.08275862068965517 |[2.5550090225996938]|0.8062384779716228|1.0           |
|2       |2019-09-01 02:00:54 |2019-09-01 02:00:57  |1              |0.08         |5         |N                 |238         |238         |1           |62.0       |0.0  |0.5    |12.56     |0.0         |0.3                  |75.36       |0.0                 |3            |0.02666666666666667 |[0.8232806850599014]|0.802429079510112 |1.0           |
|1       |2019-09-01 03:52:42 |2019-09-01 03:52:52  |0              |1.1          |3         |N                 |164         |164         |2           |20.0       |0.5  |0.0    |0.0       |0.0         |0.3                  |20.8        |0.0                 |10           |0.11000000000000001 |[3.3960328258720933]|0.8095180623993107|1.0           |
|1       |2019-09-01 03:56:47 |2019-09-01 03:57:06  |1              |1.8          |5         |N                 |264         |264         |1           |14.0       |0.0  |0.0    |1.0       |0.0         |0.3                  |15.3        |0.0                 |19           |0.09473684210526316 |[2.9248129600812285]|0.8062384779716228|1.0           |
|2       |2019-09-01 04:50:39 |2019-09-01 04:51:02  |1              |0.66         |5         |N                 |170         |161         |1           |26.2       |0.0  |0.5    |0.5       |0.0         |0.3                  |30.0        |2.5                 |23           |0.028695652173913046|[0.8859216067492417]|0.802429079510112 |1.0           |
|1       |2019-09-01 04:10:22 |2019-09-01 04:10:41  |1              |5.1          |5         |N                 |92          |92          |1           |30.0       |0.0  |0.0    |4.7       |0.0         |0.3                  |35.0        |0.0                 |19           |0.26842105263157895 |[8.286970053563481] |0.8190640805652096|1.0           |
|2       |2019-09-01 04:48:22 |2019-09-01 04:48:33  |5              |0.47         |2         |N                 |132         |132         |1           |52.0       |0.0  |0.5    |5.5       |0.0         |0.3                  |58.3        |0.0                 |11           |0.042727272727272725|[1.3191201885618873]|0.8046036715703022|1.0           |
+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+--------------------+-------------+--------------------+--------------------+------------------+--------------+
only showing top 25 rows


Remove Outliers and save cleaned dataframe to disk :
----------------------------------------------------

Loading predicted dataframe, removing "trip_distance" Outliers, and writing cleaned dataframe to disk ...

Compute top 10 ( PULocationID , DOLocationID ) pairs for total_amount :
-----------------------------------------------------------------------

Loading cleaned dataframe from disk ...

Aggregating dataframe (selected aggregation method = groupBy) ...

Top 10 ( PULocationID , DOLocationID ) pairs for total_amount :
+------------+------------+------------------+
|PULocationID|DOLocationID|      total_amount|
+------------+------------+------------------+
|         264|         264| 746344.3700001304|
|         132|         230| 606243.2000000064|
|         132|         265| 570976.4799999887|
|         138|         230| 538643.0699999881|
|         237|         236| 525581.4499998381|
|         236|         237|468543.15999986307|
|         230|         138| 405027.6599999928|
|         132|          48|381120.98000000016|
|         132|         164|378003.00000000524|
|         237|         237|364518.36999988114|
+------------+------------+------------------+
only showing top 10 rows

